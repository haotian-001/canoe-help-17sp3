<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="" data-mc-search-type="Stem" data-mc-help-system-file-name="CANoeCANalyzer.xml" data-mc-path-to-help-system="../../../../../" data-mc-conditions="" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../../../../Skins/Favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../../../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../../../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../../../Skins/Favicons/favicon-16x16.png" /><title>Simulation of MHP&#160;Sender and Receiver (MOST High Protocol)</title>
        <link href="../../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Print.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../../../Resources/Stylesheets/vTableMasterPageHeader.css" rel="stylesheet" data-mc-stylesheet-type="table" />
        <link href="../../../../Resources/Stylesheets/vStylesheet.css" rel="stylesheet" type="text/css" />
        <style>/*&lt;meta /&gt;*/

.button.expand-all-button
{
	-pie-background: linear-gradient(#ffffff, #ffffff);
}

.button.remove-highlight-button
{
	-pie-background: linear-gradient(#ffffff, #ffffff);
}

.button.collapse-all-button
{
	-pie-background: linear-gradient(#ffffff, #ffffff);
}

.needs-pie
{
	behavior: url('../../../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../../../Resources/Stylesheets/vTableSymbol.css" rel="stylesheet" data-mc-stylesheet-type="table" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../../../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../../../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../../../Skins/Favicons/favicon-16x16.png" />
        <script src="../../../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/foundation.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapGlobal.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapDom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapUtilities.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapXhr.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapTextEffects.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapSlideshow.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapMessageBus.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapMessageBus.CrossFrame.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapDefault.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapMediaQueries.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapAccessibility.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapHelpSystem.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapAliasFile.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapTopicFeedback.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapFeedbackHelper.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapSkinHelper.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapToc.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapToc.Breadcrumbs.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapToc.MiniToc.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapToc.SideMenu.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapIndex.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapGlossary.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapParser.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapSearch.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapNavigateTopics.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapLms.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapELearning.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapTopic.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapFeedback.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapMicroContentComponent.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapSearchHelper.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapTopicElements.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapTriPane.js" type="text/javascript" defer="defer">
        </script>
        <script type="text/jscript" src="../../../../Resources/vScripts/SyntaxHighlighting.js">
        </script>
        <script type="text/jscript" src="../../../../Resources/vScripts/TabSwitch.js">
        </script>
        <script type="text/javascript" src="../../../../Resources/vScripts/Vector.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../../../../CANoeCANalyzer.htm#Topics/CANoeCANalyzer/MOST/MOSTHighProtocol/MOSTHighProtocolSimulation.htm">Open topic with navigation</a>
        </p>
        <div class="Body">
            <div role="main" id="mc-main-content">
                <div data-mc-conditions="vConditions.CANoeOnly">
                    <p class="StructurePath"><a href="../MOST.htm" class="StructurePath">MOST</a> » <a href="MOSTHighProtocolOverview.htm" class="StructurePath">MOST High Protocol</a> » Simulation of MHP&#160;Sender and Receiver</p>
                    <h1>Simulation of MHP Sender and Receiver</h1>
                    <p class="MenuPath">&#160;</p>
                    <p class="AutoSearchFilterConcepts"><a name="aanchor5429"></a>
                        <MadCap:concept term="SFCore" />
                    </p>
                    <p>MOST High connection senders and receivers are easy to program in CAPL using the MOST High DLL. The DLL has to first be assigned to a network node in the Simulation Setup. To do this, right-click the desired node in the Simulation Setup and choose "Configuration..." from the context menu. Add the DLL (MOST_MHP.DLL) on the "Module" tab. The DLL is located in the Exec32 folder of the <a href="../../../SampConf/MOST/CANoe/MOSTHighProtocol/MHProtocolOverviewCn.htm">MOST High demo</a>.</p>
                    <p><a href="javascript:startDemoLoader('MHP_NodeLayer_Doc.pdf')" class="ExecuteLink">Here</a> you can find more information about the MOST_MHP.DLL.</p>
                    <p>The required functions, which are used in the following examples, are then available in CAPL.</p>
                    <p><a targets="TOGMHP_Sender" href="javascript:void(0)" class="MCToggler MCTogglerHead MCTogglerHotSpot MCToggler_Open toggler MCTogglerHotSpot_ MCHotSpotImage" data-mc-targets="TOGMHP_Sender"><img class="MCToggler_Image_Icon" src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Sender</a>
                    </p>
                    <div style="display: none;" data-mc-target-name="TOGMHP_Sender">
                        <p>A port has to be created for each outgoing MOST High connection. Each MHP port can only handle exactly one connection at a time.</p>
                        <p class="SourceCode">variables<br />{<br />&#160;&#160;long gTxPort;<br />&#160;&#160;long gDestAdr;<br />&#160;&#160;long gDestFBlockID;<br />&#160;&#160;long gDestInstID;<br />&#160;&#160;long gDestFktID;<br />&#160;&#160;long gDestOpType;<br />}</p>
                        <p class="SourceCode">on prestart<br />{<br />&#160;&#160;gTxPort = MH_CreateTxPort("");<br />&#160;&#160;gDestAdr =&#160;0x171;<br />&#160;&#160;gDestFBlockID&#160;= 0x52;<br />&#160;&#160;gDestInstID&#160;= 0x01;<br />&#160;&#160;gDestFktID = 0xE01;<br />&#160;&#160;gDestOpType = 0x0C;<br />}</p>
                        <p>A connection has to be established with the receiver in order to start a data transmission. There are several ways to do this. The simplest way is to pass the name of the file or byte array to be transmitted in the same function call.</p>
                        <p class="SourceCode">on key 'f'<br />{<br />&#160;&#160;char filename[255] =&#160;"c:\\MHP_Data.TXT";<br />&#160;&#160;MH_ReqTrans(gTxPort, gDestAdr, gDestFBlockID, gDestInstID, gDestFktID, gDestOpType, filename);<br />}</p>
                        <p class="SourceCode">on key 's'<br />{<br />&#160;&#160;byte data[200];<br />&#160;&#160;MH_ReqTrans(gTxPort, gDestAdr, gDestFBlockID, gDestInstID, gDestFktID, gDestOpType, data, elcount(data));<br />}</p>
                    </div>
                    <p><a targets="TOGMHP_Receiver" href="javascript:void(0)" class="MCToggler MCTogglerHead MCTogglerHotSpot MCToggler_Open toggler MCTogglerHotSpot_ MCHotSpotImage" data-mc-targets="TOGMHP_Receiver"><img class="MCToggler_Image_Icon" src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Receiver</a>
                    </p>
                    <div style="display: none;" data-mc-target-name="TOGMHP_Receiver">
                        <p>A port has to be created for each incoming MOST High connection. Each MHP port can only handle exactly one connection at a time.</p>
                        <p class="SourceCode">variables<br />{<br />&#160;&#160;long gRxPort;<br />&#160;&#160;const long cRxSize =&#160;65536;<br />&#160;&#160;byte gRxDataBuffer[cRxSize];<br />}</p>
                        <p class="SourceCode">on prestart<br />{<br />&#160;&#160;gRxPort = MH_CreateRxPort("");<br />}</p>
                        <p>Each receiver has to implement four callback functions. These are called during a MOST High connection.</p>
                        <p class="SourceCode">MH_IndRequestConnection(dword dsoDevice, dword fblockID, dword instanceID, dword fktID, dword opTypeID, dword prio, dword frameSize)<br />{<br />&#160;&#160;MH_AcceptConnection(gRxPort);<br />&#160;&#160;/*<br />&#160;&#160;//&#160;In case the connection cannot be accepted call the following function<br />&#160;&#160;MH_DenyConnection(prio + 1);<br />&#160;&#160;*/<br />}</p>
                        <p>Once MH_AcceptConnection() is called, the second callback function is used to request a buffer. This can be either a file or a byte array in CAPL.</p>
                        <p class="SourceCode">MH_IndRxBufferRequested (dword handle, long isPacketBegin)<br />{<br />&#160;&#160;MH_SetRxBuffer(gRxPort, gRxDataBuffer, cRxSize);<br />&#160;&#160;/*<br />&#160;&#160;// alternatively the data can be stored in a file<br />&#160;&#160;char filename[512] =&#160;"c:\\MHP_Data.TXT";<br />&#160;&#160;// streaming data to a file<br />&#160;&#160;MH_SetRxBuffer(gRxPort, 0, filename);<br />&#160;&#160;*/<br />}</p>
                        <p>The third callback function signals the end of the buffer write process. The reasons for this can be that the buffer is full or that a MOST High packet was fully transmitted. Data transmitted up to that point can be evaluated in both cases.</p>
                        <p class="SourceCode">MH_IndRxBufferFinished (dword handle, long filledSize, long reason)<br />{<br />&#160;&#160;write("Buffer filled with %d bytes.", filledSize);<br />}</p>
                        <p>A further callback function is called when the connection is terminated. It returns the reason for ending the connection. This function is called when the transmission of all connection data is completed.</p>
                        <p class="SourceCode">MH_IndRxConnectionClosed(dword handle, long res)<br />{<br />&#160;&#160;/*<br />&#160;&#160;//&#160;user-defined handling<br />&#160;&#160;if (res == 0) // Regular termination<br />&#160;&#160;{<br />&#160;&#160;}<br />&#160;&#160;*/<br />}</p>
                    </div>
                    <p>The examples described here represent only a small fraction of the DLL functionality. The <a href="../../../SampConf/MOST/CANoe/MOSTHighProtocol/MHProtocolOverviewCn.htm">MOST High demo</a> contains more comprehensive use cases.</p>
                    <p class="LinkList"><a href="MOSTHighProtocolOverview.htm" class="LinkList">MOST&#160;High Protocol:&#160;Overview</a>&#160;&#160;•&#160;&#160;<a href="../../Ribbon/Analysis/MOSTHighObserverConfiguration.htm" class="LinkList">Observer and Combiner</a>&#160;&#160;•&#160;&#160;<a href="MOSTHighProtocolTestAndFaultInjection.htm" class="LinkList">Test and Fault Injection of MHP&#160;Connections</a></p>
                </div>
            </div>
        </div>
        <div class="Footer">
            <div class="FooterWhite">
                <table class="FooterWhite" style="border-collapse: collapse;margin-left: auto;margin-right: auto;">
                    <col style="width: 70px;" data-mc-conditions="vConditions.HTML5Link" />
                    <col style="width: 16px;" data-mc-conditions="vConditions.HTML5Link" />
                    <col />
                    <tbody>
                        <tr>
                            <td>
                                <div class="buttons popup-container clearfix topicToolbarProxy topicToolbarProxyFooter _Skins_HTML5TopicToolbar mc-component nocontent">
                                    <div class="button-group-container-left">
                                        <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                            <div>
                                                <div role="img" class="button-icon-wrapper" aria-label="Expand all">
                                                    <div class="button-icon"> </div>
                                                </div>
                                            </div>
                                        </button>
                                        <button class="button needs-pie remove-highlight-button" title="Remove Highlights">
                                            <div>
                                                <div role="img" class="button-icon-wrapper">
                                                    <div class="button-icon"> </div>
                                                </div>
                                            </div>
                                        </button>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <p class="vec_BuildInfo"><a href="../../../Shared/HowToUseOnlineHelp.htm" title="Tips for using the help" alt="Tips for using the help"><img src="../../../../Resources/vImages/vBackstage/vHelpInfo.png" /></a>
                                </p>
                            </td>
                            <td>
                                <p class="vec_BuildInfo" style="text-align: right;"><span class="mc-variable Vector.BuildTime variable">2023-09-26T19:49:32</span>
                                </p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <table style="width: 100%;border-collapse: separate;border-spacing: 3px 0px;margin-left: auto;margin-right: auto;caption-side: top;">
                <col />
                <col />
                <col />
                <col data-mc-conditions="vConditions.HTML5Link" />
                <tbody>
                    <tr>
                        <td style="background-color: #b70032;padding-left: 5pt;padding-right: 5pt;padding-top: 5pt;padding-bottom: 5pt;">
                            <p class="vec_Footer">©&#160;Vector Informatik GmbH</p>
                        </td>
                        <td style="background-color: #b70032;padding-left: 5pt;padding-right: 5pt;padding-top: 5pt;padding-bottom: 5pt;text-align: right;">
                            <p class="vec_FooterBold">
                                <MadCap:conditionalText data-mc-conditions="vConditions.vTESTstudioExcluded,vConditions.TestDataEditorExcluded">CANoe</MadCap:conditionalText> Version <MadCap:conditionalText data-mc-conditions="vConditions.vTESTstudioExcluded">17 SP3</MadCap:conditionalText></p>
                        </td>
                        <td style="background-color: #b70032;padding-left: 5pt;padding-right: 5pt;padding-top: 5pt;padding-bottom: 0pt;text-align: right;">
                            <p class="vec_Footer"><a href="../../../Shared/ContactCopyrightLicense.htm" class="vec_Footer MCXref xref xrefvec_Footer">Contact/Copyright/License</a>
                            </p>
                        </td>
                        <td style="background-color: #b70032;padding-left: 5pt;padding-right: 5pt;padding-top: 5pt;padding-bottom: 0pt;text-align: right;">
                            <p class="vec_Footer"><a href="https://www.vector.com/int/en/company/get-info/privacy-policy/" target="_blank" class="vec_Footer">Data Privacy Notice</a>
                            </p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </body>
</html>